<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­Ÿå¾·çˆ¾ä¹‹å¾Œï¼šåŸºå› èˆ‡éºå‚³</title>
    
    <!-- å¼•å…¥ Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Comfortaa:wght@700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-green: #6B8E23; /* æ©„æ¬–ç¶  */
            --light-green: #F0FFF0;   /* èœœç“œç¶  */
            --earth-brown: #8B4513;   /* åœŸå£¤è‰² */
            --dna-blue: #4fc3f7;      /* DNA è— */
            --chromosome-color: #ffcc80;
            --text-color: #333333;
            --correct-color: #4CAF50;
            --wrong-color: #e74c3c;
            --disabled-gray: #ccc;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fcfbf4;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.8;
            font-size: 19px; /* åŠ å¤§å­—é«”ä¿è­·è¦–åŠ› */
            overscroll-behavior: none;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }

        header {
            text-align: center;
            border-bottom: 3px solid var(--primary-green);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        h1 { color: var(--primary-green); font-size: 2.5em; margin-bottom: 10px; }
        .subtitle { font-size: 1.2em; color: #666; }

        section {
            margin-bottom: 40px;
            padding: 30px;
            background-color: var(--light-green);
            border-radius: 15px;
            border-left: 8px solid var(--primary-green);
            transition: all 0.5s;
            position: relative;
        }

        section.locked {
            opacity: 0.6;
            pointer-events: none;
            filter: grayscale(0.8);
        }

        h2 { color: var(--earth-brown); display: flex; align-items: center; margin-top: 0; }
        h2 i { margin-right: 15px; color: var(--primary-green); }

        /* --- Part 1: Micro Zoom (Split Layout) --- */
        .zoom-stage {
            height: 400px;
            background: white;
            border-radius: 15px;
            border: 2px solid #ccc;
            overflow: hidden;
            display: flex; /* Flex layout for left-right split */
            margin-top: 20px;
        }

        /* Left side: Visuals */
        .zoom-visual-area {
            flex: 1; /* Takes remaining space */
            position: relative;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-right: 2px solid #ddd;
        }

        .zoom-object {
            transition: transform 0.3s ease;
            cursor: pointer;
            text-align: center;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .zoom-object:hover { transform: scale(1.05); }
        
        /* Animation class for correct answer */
        .zoom-out-vanish {
            animation: zoomVanish 0.8s forwards;
        }

        /* Stage Visuals */
        /* 1. Simple Cell */
        .simple-cell {
            width: 250px; height: 250px;
            background-color: #ffecb3;
            border: 6px solid #ffca28;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
        }
        .simple-nucleus {
            width: 100px; height: 100px;
            background-color: #ef5350;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            position: relative;
        }
        
        /* 2. Chromosome (Big Rod) */
        .big-chrom-rod {
            width: 80px; height: 300px;
            background: #ffcc80;
            border: 5px solid #f57c00;
            border-radius: 40px;
            position: relative;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
        }
        .big-chrom-rod::after {
            content: ''; position: absolute;
            top: 50%; left: -5px; right: -5px; height: 30px;
            background: #e65100;
            border-radius: 15px;
            transform: translateY(-50%);
        }

        /* 3. DNA with Gene Box */
        .dna-container {
            position: relative;
            display: flex; align-items: center; justify-content: center;
        }
        
        .dna-strand-long {
            font-size: 250px; color: var(--dna-blue); transform: rotate(90deg); filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
        }
        
        .gene-box-highlight {
            position: absolute;
            width: 220px; height: 140px;
            border: 5px dashed #ff9800;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4);
            display: flex; align-items: flex-start; justify-content: center;
        }
        
        .gene-label-tag {
            background: #ff9800; color: white; padding: 5px 15px; border-radius: 0 0 10px 10px; font-weight: bold; font-size: 0.9em; margin-top: -5px;
        }

        .gene-highlight { 
            position: absolute; width: 100%; height: 40px; 
            background: rgba(255, 235, 59, 0.5); border: 2px dashed orange;
            top: 50%; left: 0; transform: translateY(-50%);
            display: none;
        }

        /* Right side: Questions */
        .zoom-sidebar {
            width: 350px; /* Fixed width */
            background: white;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 10;
        }

        .blank-input {
            border: none;
            border-bottom: 2px solid #888;
            background: transparent;
            font-size: 1.1em;
            width: 120px;
            text-align: center;
            color: var(--primary-green);
            font-weight: bold;
            font-family: 'Noto Sans TC', sans-serif;
        }
        .blank-input:focus { outline: none; border-bottom-color: var(--primary-green); }
        .blank-input.correct { border-bottom-color: var(--correct-color); color: var(--correct-color); pointer-events: none; }

        .click-hint {
            position: absolute; bottom: 20px; 
            font-weight: bold; color: #555; 
            background: rgba(255,255,255,0.8);
            padding: 5px 15px; border-radius: 20px;
            animation: pulse 2s infinite;
        }

        /* Sort Game Styles */
        .sort-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .sort-slots-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .sort-slot {
            width: 80px; height: 50px;
            border: 2px dashed #999;
            border-radius: 10px;
            background: #f0f0f0;
            display: flex; justify-content: center; align-items: center;
            font-size: 0.85em; font-weight: bold;
        }
        .sort-slot.filled { border-style: solid; border-color: var(--primary-green); background: #e8f5e9; }
        
        .sort-cards-wrapper {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            background: #fff8e1;
            padding: 10px;
            border-radius: 10px;
            min-height: 70px;
            width: 100%;
        }
        .sort-card {
            padding: 5px 10px;
            background: white;
            border: 2px solid var(--earth-brown);
            border-radius: 8px;
            cursor: grab;
            font-weight: bold;
            font-size: 0.9em;
            color: var(--earth-brown);
            box-shadow: 0 2px 0 #8d6e63;
        }
        .sort-card:active { cursor: grabbing; transform: translateY(2px); box-shadow: none; }

        .check-btn {
            margin-top: 15px;
            padding: 10px 25px;
            background: var(--earth-brown);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            align-self: center;
        }
        .check-btn:hover { background: #5d4037; }

        /* --- Part 2: Diagram & Labels --- */
        .diagram-container {
            position: relative;
            height: 400px;
            background: white;
            border-radius: 15px;
            margin-top: 20px;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .visual-area {
            position: relative;
            width: 300px;
            height: 350px;
        }

        .chrom-rod {
            width: 40px; height: 280px;
            background: #ffcc80;
            border-radius: 20px;
            position: absolute;
            top: 25px;
            border: 3px solid #f57c00;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.1);
            transition: all 0.5s;
        }
        
        .rod-left { left: 80px; }
        .rod-right { left: 180px; background: #90caf9; border-color: #1976d2; }

        .gene-band {
            position: absolute; width: 100%; height: 15px;
            background: #ef5350; top: 50px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Guide Lines */
        .guide-line {
            position: absolute;
            background: #555;
            z-index: 0;
        }

        /* Concept Overlays */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; opacity: 0; transition: opacity 0.5s;
        }
        .overlay.active { opacity: 1; }

        .bracket-homo {
            position: absolute; top: 10px; left: 60px; width: 180px; height: 330px;
            border: 4px dashed #555; border-radius: 15px;
            animation: pulse 2s infinite;
        }
        .pointer-dna {
            position: absolute; top: 130px; left: 50px;
            font-size: 1.5em; font-weight: bold; color: var(--dna-blue);
            background: rgba(255,255,255,0.95); padding: 5px;
            border: 3px solid var(--dna-blue); border-radius: 50%;
            width: 100px; height: 100px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.6);
            z-index: 5;
        }
        .gene-segment-c {
            position: absolute; top: 60px; left: 75px; width: 50px; height: 25px;
            background: rgba(239, 83, 80, 0.6); border: 2px solid #c62828;
            box-shadow: 0 0 10px #c62828; z-index: 5;
        }
        .gene-segment-d-l {
            position: absolute; bottom: 60px; left: 75px; width: 50px; height: 25px;
            background: #66bb6a; border: 2px solid #2e7d32; z-index: 5;
        }
        .gene-segment-d-r {
            position: absolute; bottom: 60px; left: 175px; width: 50px; height: 25px;
            background: #66bb6a; border: 2px solid #2e7d32; z-index: 5;
        }
        .connector-d {
            position: absolute; bottom: 70px; left: 125px; width: 50px; height: 4px;
            background: #2e7d32; z-index: 4;
        }

        /* Question Panel */
        .q-panel {
            width: 350px;
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffe0b2;
            margin-left: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .p2-step { display: none; animation: fadeIn 0.5s; }
        .p2-step.active { display: block; }
        .concept-badge { background: var(--earth-brown); color: white; padding: 2px 10px; border-radius: 10px; font-size: 0.9em; margin-bottom: 10px; display: inline-block; }

        select.concept-select {
            font-size: 1em; padding: 5px; border: 2px solid var(--primary-green); border-radius: 5px; background: white; width: 100%; cursor: pointer; margin-top: 5px;
        }
        select.correct { border-color: var(--correct-color); background: #e8f5e9; color: var(--correct-color); pointer-events: none; }
        select.wrong { border-color: var(--wrong-color); background: #ffebee; animation: shake 0.4s; }
        
        .check-btn {
            margin-top: 15px; padding: 8px 20px; background: var(--earth-brown); color: white; border: none; border-radius: 20px; cursor: pointer;
        }
        .check-btn:hover { background: #5d4037; }

        /* --- Part 2.5: Locus Clarification --- */
        .locus-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; margin-top: 20px; }
        .locus-visual { position: relative; width: 250px; height: 300px; background: white; border-radius: 15px; border: 1px solid #ddd; display: flex; justify-content: center; align-items: center; }
        .locus-band { width: 100%; height: 20px; background: #66bb6a; color: white; font-weight: bold; display: flex; justify-content: center; align-items: center; font-family: 'Comfortaa'; position: absolute; top: 60px; }
        .locus-line { position: absolute; top: 95px; left: 10%; width: 80%; border-top: 3px dashed #666; z-index: 10; }
        .locus-label { position: absolute; top: 110px; width: 100%; text-align: center; color: #555; font-weight: bold; background: rgba(255,255,255,0.8); }
        .label-p { position: absolute; bottom: -30px; width: 100%; text-align: center; font-weight: bold; color: var(--earth-brown); }
        .label-m { position: absolute; bottom: -30px; width: 100%; text-align: center; font-weight: bold; color: #1976d2; }
        .locus-explanation { flex: 1; max-width: 500px; display: flex; flex-direction: column; gap: 15px; }
        .exp-card { background: white; padding: 15px; border-radius: 10px; border-left: 5px solid var(--primary-green); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .exp-card h3 { margin: 0 0 5px 0; font-size: 1.1em; color: var(--earth-brown); display: flex; align-items: center; }
        .exp-card h3 i { margin-right: 10px; color: var(--primary-green); }
        .exp-card p { margin: 0; font-size: 0.95em; color: #555; }
        .exp-card.highlight { background: #e8f5e9; border-color: var(--earth-brown); }
        
        .locus-quiz { margin-top: 20px; padding: 20px; background: #fff3e0; border-radius: 15px; text-align: center; width: 100%; }
        .quiz-option-container { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .quiz-btn { background: white; border: 2px solid var(--earth-brown); color: var(--earth-brown); padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .quiz-btn:hover { background: var(--earth-brown); color: white; }
        .quiz-question-box { animation: fadeIn 0.5s; display: none; }
        .quiz-question-box.active { display: block; }

        /* --- Part 3: Drag Game --- */
        .game-area { background: white; padding: 20px; border-radius: 15px; display: flex; flex-direction: column; align-items: center; border: 3px dashed var(--earth-brown); }
        .pair-container { display: flex; gap: 120px; margin: 30px 0; }
        .chrom-bar { width: 60px; height: 300px; background: #a5d6a7; border-radius: 30px; border: 4px solid #388e3c; position: relative; display: flex; justify-content: center; }
        .locus { position: absolute; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; font-family: 'Comfortaa'; font-size: 1.5em; z-index: 5; }
        .fixed-allele { background: white; border: 3px solid #333; top: 50px; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .drop-zone { border: 3px dashed #777; background: rgba(255,255,255,0.6); transition: all 0.3s; }
        .drop-zone.hover { background: #fff9c4; transform: scale(1.1); border-color: orange; }
        .drop-zone.correct-filled { background: white; border: 3px solid var(--correct-color); color: var(--correct-color); }
        .pos-top { top: 50px; }
        .pos-bottom { bottom: 50px; }
        .allele-source { display: flex; gap: 20px; background: #e0e0e0; padding: 20px; border-radius: 15px; margin-top: 20px; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        .draggable-allele { width: 60px; height: 60px; border-radius: 50%; background: white; border: 3px solid var(--earth-brown); color: var(--earth-brown); font-family: 'Comfortaa'; font-weight: bold; font-size: 1.8em; display: flex; justify-content: center; align-items: center; cursor: grab; box-shadow: 0 5px 0 #8d6e63; touch-action: none; z-index: 100; transition: transform 0.1s; }
        .draggable-allele:active { cursor: grabbing; transform: scale(0.9); box-shadow: 0 2px 0 #8d6e63; }

        /* --- Part 4: Myth --- */
        .myth-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .myth-card { background: white; border: 2px solid #ddd; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .myth-statement { font-weight: bold; margin-bottom: 15px; font-size: 1.05em; }
        .myth-btn { padding: 8px 15px; margin-right: 5px; border-radius: 5px; cursor: pointer; border: 1px solid #ccc; font-weight: bold; }
        .myth-btn.correct { background: #e8f5e9; color: green; border-color: green; }
        .myth-btn.wrong { background: #ffebee; color: red; border-color: red; }
        .myth-fb { margin-top: 10px; font-size: 0.9em; min-height: 20px; }

        /* Footer */
        .footer-nav { text-align: center; margin-top: 50px; border-top: 2px solid #eee; padding-top: 20px; }
        .next-btn { background-color: var(--primary-green); color: white; padding: 15px 40px; font-size: 1.5em; border-radius: 50px; text-decoration: none; border: none; cursor: pointer; opacity: 0.5; pointer-events: none; }
        .next-btn.active { opacity: 1; pointer-events: auto; background-color: #556B2F; }

        /* Animations */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes zoomVanish { 
            0% { transform: scale(1); opacity: 1; } 
            50% { transform: scale(2); opacity: 0.5; } 
            100% { transform: scale(3); opacity: 0; } 
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); } }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><i class="fas fa-microscope"></i> åŸºå› èˆ‡éºå‚³çš„é—œä¿‚</h1>
        <div class="subtitle">å–®å…ƒäº”ï¼šå¾®è§€ä¸–ç•Œèˆ‡å­Ÿå¾·çˆ¾çš„é€£çµ</div>
    </header>

    <!-- Part 1: Micro Zoom (Click & Answer) -->
    <section id="s1">
        <h2><i class="fas fa-search-plus"></i> 1. ç´°èƒå…§çš„å¾®è§€æ¢éšª</h2>
        <p>éºå‚³ç‰©è³ªåˆ°åº•è—åœ¨å“ªè£¡ï¼Ÿè«‹å¡«å¯«å³å´ç­”æ¡ˆå¾Œï¼Œ<b>é»æ“Šåœ–ç‰‡</b>é€²å…¥ä¸‹ä¸€å±¤ï¼</p>
        
        <div class="zoom-stage">
            <!-- Left Side: Visuals -->
            <div class="zoom-visual-area">
                <!-- Level 1 -->
                <div id="view-cell" class="zoom-object" onclick="submitAnswer(1)">
                    <div class="simple-cell"><div class="simple-nucleus"></div></div>
                    <div class="click-hint">å¡«ç­”å¾Œé»æˆ‘æ”¾å¤§</div>
                </div>
                <!-- Level 2 -->
                <div id="view-chromo" class="zoom-object" style="display:none;" onclick="submitAnswer(2)">
                    <div class="big-chrom-rod"></div>
                    <div class="click-hint">å¡«ç­”å¾Œé»æˆ‘è§£é–‹</div>
                </div>
                <!-- Level 3 -->
                <div id="view-dna" class="zoom-object" style="display:none;" onclick="submitAnswer(3)">
                    <div class="dna-container">
                        <i class="fas fa-dna dna-strand-long"></i>
                        <div class="gene-box-highlight"><div class="gene-label-tag">åŸºå›  (Gene)</div></div>
                    </div>
                    <div class="click-hint">å¡«ç­”å¾Œé»æˆ‘ç¢ºèª</div>
                </div>
                <!-- Final state placeholder -->
                <div id="view-final" class="zoom-object" style="display:none;">
                     <div class="dna-container">
                        <i class="fas fa-dna dna-strand-long" style="opacity:0.3;"></i>
                        <div style="font-size:2em; font-weight:bold; color:var(--primary-green);">å®Œæˆæ¢ç´¢!</div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Sidebar Questions -->
            <div class="zoom-sidebar" id="sidebar-q">
                <div id="q1-box">
                    <h3 style="color:var(--earth-brown);">ç¬¬ä¸€å±¤ï¼šç´°èƒæ ¸</h3>
                    <p>æ”¾å¤§å¾Œç™¼ç¾äº†æ£’ç‹€çš„æ§‹é€ ...<br>é€™äº›æ˜¯<b>æŸ“è‰²é«”</b>ã€‚</p>
                    <p>ç”±æ­¤å¯çŸ¥ï¼ŒæŸ“è‰²é«”ä½æ–¼ <input type="text" id="ans-1" class="blank-input" placeholder="(è¼¸å…¥ä½ç½®)"> ä¸­ã€‚</p>
                </div>
                <div id="q2-box" style="display:none;">
                    <h3 style="color:var(--earth-brown);">ç¬¬äºŒå±¤ï¼šæŸ“è‰²é«”</h3>
                    <p>æŠŠæŸ“è‰²é«”è§£é–‹å¾Œ...<br>åŸä¾†å®ƒæ˜¯ç”±é•·é•·çš„ <b>DNA</b> èˆ‡è›‹ç™½è³ªçºç¹è€Œæˆçš„ï¼</p>
                    <p>æ‰€ä»¥ï¼ŒDNA çºç¹å½¢æˆäº† <input type="text" id="ans-2" class="blank-input" placeholder="(è¼¸å…¥æ§‹é€ )">ã€‚</p>
                </div>
                <div id="q3-box" style="display:none;">
                    <h3 style="color:var(--earth-brown);">ç¬¬ä¸‰å±¤ï¼šDNA</h3>
                    <p>DNA ä¸Šæœ‰è¨±å¤šç‰‡æ®µã€‚<br>å…¶ä¸­ä¸€æ®µå…·æœ‰ç‰¹å®šåŠŸèƒ½ï¼ˆèƒ½æ±ºå®šæ€§ç‹€ï¼‰çš„ DNA ç‰‡æ®µï¼Œç¨±ç‚º <input type="text" id="ans-3" class="blank-input" placeholder="(è¼¸å…¥å–®ä½)">ã€‚</p>
                </div>
                
                <!-- Sort Game Container -->
                <div id="sort-game" style="display:none;">
                    <h3 style="color:var(--earth-brown);"><i class="fas fa-sort-amount-down"></i> å±¤æ¬¡æ’åˆ—æŒ‘æˆ°</h3>
                    <p style="font-size:0.9em;">è«‹æ‹–æ›³ä¸‹æ–¹å­—å¡ï¼Œç”±<b>å¤§åˆ°å°</b>æ’åˆ—åŒ…å«é—œä¿‚ï¼š</p>
                    
                    <div class="sort-container">
                        <div class="sort-slots-wrapper">
                            <div class="sort-slot" data-index="0"></div>
                            <i class="fas fa-chevron-right" style="color:#ccc;"></i>
                            <div class="sort-slot" data-index="1"></div>
                            <i class="fas fa-chevron-right" style="color:#ccc;"></i>
                            <div class="sort-slot" data-index="2"></div>
                            <i class="fas fa-chevron-right" style="color:#ccc;"></i>
                            <div class="sort-slot" data-index="3"></div>
                            <i class="fas fa-chevron-right" style="color:#ccc;"></i>
                            <div class="sort-slot" data-index="4"></div>
                        </div>
                        
                        <div class="sort-cards-wrapper" id="sort-source">
                            <!-- Cards inserted by JS -->
                        </div>
                    </div>
                    
                    <button class="check-btn" onclick="checkSortGame()">æª¢æŸ¥æ’åˆ—</button>
                    <div id="sort-feedback" style="margin-top:10px; font-weight:bold; font-size:0.9em; min-height:20px;"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Part 2: Diagram (Sequential) -->
    <section id="s2" class="locked">
        <h2><i class="fas fa-project-diagram"></i> 2. èªè­˜åŒæºæŸ“è‰²é«”</h2>
        <p>è«‹ä¾ç…§æ¦‚å¿µå‡ºç¾çš„é †åºï¼Œè¾¨è­˜åœ–ç‰‡ä¸­å°æ‡‰çš„æ§‹é€ åç¨±ã€‚</p>
        
        <div class="diagram-container">
            <div class="visual-area">
                <div class="chrom-rod rod-left">
                    <div class="gene-band"></div>
                </div>
                <div class="chrom-rod rod-right">
                    <div class="gene-band"></div>
                </div>
                
                <!-- Overlays -->
                <div id="overlay-A" class="overlay active"><div class="bracket-homo"></div></div>
                <div id="overlay-B" class="overlay"><div class="pointer-dna"><i class="fas fa-dna"></i></div></div>
                <div id="overlay-C" class="overlay"><div class="gene-segment-c"></div></div>
                <div id="overlay-D" class="overlay"><div class="gene-segment-d-l"></div><div class="gene-segment-d-r"></div><div class="connector-d"></div></div>
            </div>
            
            <div class="q-panel">
                <!-- Step A -->
                <div id="p2-step-A" class="p2-step active">
                    <span class="concept-badge">æ¦‚å¿µ A</span>
                    <p>è«‹è§€å¯Ÿå·¦åœ–è™›ç·šæ¡†ï¼šé€™å…©æ¢å¤§å°å½¢ç‹€ç›¸ä¼¼çš„æŸ“è‰²é«”ï¼Œä¸€æ¢ä¾†è‡ªçˆ¶æ–¹ï¼Œä¸€æ¢ä¾†è‡ªæ¯æ–¹ã€‚</p>
                    <p>å®ƒå€‘åˆç¨±ç‚ºï¼š
                        <select class="concept-select" id="p2-select-A">
                            <option value="">è¯·é¸æ“‡</option><option value="homo">åŒæºæŸ“è‰²é«”</option><option value="dna">DNA</option><option value="gene">åŸºå› </option><option value="allele">ç­‰ä½åŸºå› </option>
                        </select>
                    </p>
                    <button class="check-btn" onclick="verifyConcept('A')">æª¢æŸ¥ç­”æ¡ˆ</button>
                </div>
                <!-- Step B -->
                <div id="p2-step-B" class="p2-step">
                    <span class="concept-badge">æ¦‚å¿µ B</span>
                    <p>è«‹è§€å¯Ÿå·¦åœ–è™›ç·šæ¡†ï¼šçµ„æˆæŸ“è‰²é«”çš„ä¸»è¦éºå‚³ç‰©è³ªï¼Œå‘ˆç¾é›™è‚¡èºæ—‹çµæ§‹ã€‚</p>
                    <p>é€™æ˜¯ï¼š
                        <select class="concept-select" id="p2-select-B">
                            <option value="">è¯·é¸æ“‡</option><option value="homo">åŒæºæŸ“è‰²é«”</option><option value="dna">DNA</option><option value="gene">åŸºå› </option><option value="allele">ç­‰ä½åŸºå› </option>
                        </select>
                    </p>
                    <button class="check-btn" onclick="verifyConcept('B')">æª¢æŸ¥ç­”æ¡ˆ</button>
                </div>
                <!-- Step C -->
                <div id="p2-step-C" class="p2-step">
                    <span class="concept-badge">æ¦‚å¿µ C</span>
                    <p>è«‹è§€å¯Ÿå·¦åœ–è™›ç·šæ¡†ï¼šDNA ä¸Šå…·æœ‰ç‰¹å®šåŠŸèƒ½ï¼ˆæ§åˆ¶æ€§ç‹€ï¼‰çš„ä¸€å°æ®µç‰‡æ®µã€‚</p>
                    <p>ç¨±ç‚ºï¼š
                        <select class="concept-select" id="p2-select-C">
                            <option value="">è¯·é¸æ“‡</option><option value="homo">åŒæºæŸ“è‰²é«”</option><option value="dna">DNA</option><option value="gene">åŸºå› </option><option value="allele">ç­‰ä½åŸºå› </option>
                        </select>
                    </p>
                    <button class="check-btn" onclick="verifyConcept('C')">æª¢æŸ¥ç­”æ¡ˆ</button>
                </div>
                <!-- Step D -->
                <div id="p2-step-D" class="p2-step">
                    <span class="concept-badge">æ¦‚å¿µ D</span>
                    <p>è«‹è§€å¯Ÿå·¦åœ–è™›ç·šæ¡†ï¼šä½æ–¼åŒæºæŸ“è‰²é«”çš„<b>ç›¸å°ä½ç½®</b>ä¸Šï¼Œæ§åˆ¶åŒä¸€æ€§ç‹€çš„åŸºå› å¤¥ä¼´ã€‚</p>
                    <p>ç¨±ç‚ºï¼š
                        <select class="concept-select" id="p2-select-D">
                            <option value="">è¯·é¸æ“‡</option><option value="homo">åŒæºæŸ“è‰²é«”</option><option value="dna">DNA</option><option value="gene">åŸºå› </option><option value="allele">ç­‰ä½åŸºå› </option>
                        </select>
                    </p>
                    <button class="check-btn" onclick="verifyConcept('D')">æª¢æŸ¥ç­”æ¡ˆ</button>
                </div>
                <div id="s2-feedback" style="margin-top:15px; font-weight:bold; color:var(--primary-green);"></div>
            </div>
        </div>
    </section>

    <!-- Part 2.5: Locus Concepts (Enhanced) -->
    <section id="s2-5" class="locked">
        <h2><i class="fas fa-map-signs"></i> 2.5 è§€å¿µé‡æ¸…ï¼šåŸºå› åº§èˆ‡ç­‰ä½åŸºå› </h2>
        
        <div class="locus-container">
            <div class="locus-visual">
                <div class="chrom-rod" style="left:auto; right:130px; height:200px; top:auto;">
                    <div class="locus-band">A</div><div class="label-p">çˆ¶æ–¹</div>
                </div>
                <div class="chrom-rod blue" style="left:auto; left:130px; height:200px; top:auto;">
                    <div class="locus-band">a</div><div class="label-m">æ¯æ–¹</div>
                </div>
                <div class="locus-line"></div>
                <div class="locus-label">åŸºå› åº§ (Locus)</div>
            </div>

            <div class="locus-explanation">
                <div class="exp-card">
                    <h3><i class="fas fa-question-circle"></i> è§€å¿µå°è®€</h3>
                    <p style="line-height:1.6; color:#333;">
                        æ§åˆ¶åŒä¸€æ€§ç‹€çš„éºå‚³å› å­ä½æ–¼åŒæºæŸ“è‰²é«”ä¸Šçš„ç›¸å°ä½ç½®ï¼Œäº‹å¯¦ä¸Šéºå‚³å› å­å°±æ˜¯ç­‰ä½åŸºå› ï¼Œå› æ­¤åŒä¸€åŸºå› æœ‰<b>å…©å€‹</b>ç­‰ä½åŸºå› ã€‚è€Œç­‰ä½åŸºå› æœ‰<b>å…©ç¨®</b>å½¢å¼ï¼Œå¦‚é¡¯æ€§å’Œéš±æ€§ã€‚<br><br>
                        <span style="color:#e65100; font-weight:bold;">é€™æ®µè©±çš„ã€Œå…©å€‹ã€å’Œã€Œå…©ç¨®ã€æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿ</span><br>
                        ğŸ‘‰ <b>ã€Œå…©å€‹ã€</b>æŒ‡æ•¸é‡ï¼šå› ç‚ºæŸ“è‰²é«”æˆå°ï¼Œæ‰€ä»¥ä½ç½®æœ‰å…©å€‹ã€‚<br>
                        ğŸ‘‰ <b>ã€Œå…©ç¨®ã€</b>æŒ‡å½¢å¼ï¼šåŸºå› çš„å…§å®¹å¯èƒ½ä¸åŒ (å¦‚ A èˆ‡ a)ã€‚
                    </p>
                </div>
                <div class="exp-card highlight">
                    <h3><i class="fas fa-link"></i> é‡è¦é€£çµ</h3>
                    <p>å­Ÿå¾·çˆ¾æå‡ºçš„ã€Œéºå‚³å› å­ã€ = ç¾ä»£çš„ã€Œç­‰ä½åŸºå› ã€</p>
                </div>
            </div>
        </div>

        <div class="locus-quiz">
            <!-- Q1 -->
            <div id="locus-q1" class="quiz-question-box active">
                <p><b>Q1 (1/3)ï¼š</b>æ§åˆ¶äººçš„ä¸€å€‹æ€§ç‹€ç”±ï¼¿ï¼¿ï¼¿ç­‰ä½åŸºå› æ‰€æ§åˆ¶ï¼Œæ­¤ç­‰ä½åŸºå› é€šå¸¸æœ‰é¡¯æ€§å’Œéš±æ€§ï¼¿ï¼¿ï¼¿å½¢å¼ã€‚</p>
                <div class="quiz-option-container">
                    <button class="quiz-btn" onclick="checkLocusQuiz(1, 1)">1 å€‹, 2 ç¨®</button>
                    <button class="quiz-btn" onclick="checkLocusQuiz(1, 2)">2 å€‹, 1 ç¨®</button>
                    <button class="quiz-btn" onclick="checkLocusQuiz(1, 3)">2 å€‹, 2 ç¨®</button>
                </div>
            </div>
            
            <!-- Q2 -->
            <div id="locus-q2" class="quiz-question-box">
                <p><b>Q2 (2/3)ï¼š</b>è‹¥æœ‰å€‹åŸºå› æœ‰ Aã€A'ã€a ä¸‰ç¨®å‹æ…‹ï¼ˆä¾‹å¦‚è¡€å‹ï¼‰ï¼Œä½†åœ¨åŒæºæŸ“è‰²é«”çš„ç›¸å°ä½ç½®ä¸Šä¸€æ¬¡åªèƒ½æ”¾å…©å€‹ï¼Œè«‹å•æ§åˆ¶æ­¤æ€§ç‹€çš„ç­‰ä½åŸºå› æœ‰å¹¾ç¨®å½¢å¼ï¼Ÿ</p>
                <div class="quiz-option-container">
                    <button class="quiz-btn" onclick="checkLocusQuiz(2, 1)">å…©ç¨®</button>
                    <button class="quiz-btn" onclick="checkLocusQuiz(2, 2)">ä¸‰ç¨®</button>
                </div>
            </div>

            <!-- Q3 -->
            <div id="locus-q3" class="quiz-question-box">
                <p><b>Q3 (3/3)ï¼š</b>ã€ŒåŸºå› åº§ (Locus)ã€æ˜¯æŒ‡åŸºå› åœ¨æŸ“è‰²é«”ä¸Šçš„ä»€éº¼ï¼Ÿ</p>
                <div class="quiz-option-container">
                    <button class="quiz-btn" onclick="checkLocusQuiz(3, 1)">ä½ç½®</button>
                    <button class="quiz-btn" onclick="checkLocusQuiz(3, 2)">å½¢ç‹€</button>
                    <button class="quiz-btn" onclick="checkLocusQuiz(3, 3)">é¡è‰²</button>
                </div>
            </div>

            <div id="locus-feedback" style="margin-top:10px; font-weight:bold; height:25px; color:var(--primary-green);"></div>
        </div>
    </section>

    <!-- Part 3: Drag -->
    <section id="s3" class="locked">
        <h2><i class="fas fa-map-marker-alt"></i> 3. ç­‰ä½åŸºå› å®šä½è³½</h2>
        <div style="background:#fff3e0; padding:15px; border-radius:10px; margin-bottom:20px; border:1px solid #ffe0b2;">
            <p style="margin:0;">
                <i class="fas fa-flag"></i> <b>ä»»å‹™ç›®æ¨™ï¼š</b>
                å·²çŸ¥æ­¤ç”Ÿç‰©çš„åŸºå› å‹ç‚º <b>AA</b>ã€‚<br>
                å·¦æ–¹æŸ“è‰²é«”å·²æœ‰ä¸€å€‹ <b>A</b>ï¼Œè«‹å°‡ç¬¬äºŒå€‹ <b>A</b> æ‹–æ›³åˆ°å³é‚ŠæŸ“è‰²é«”çš„<b>æ­£ç¢ºä½ç½®</b>ä¸Šï¼
            </p>
        </div>

        <div class="game-area">
            <div class="pair-container">
                <div class="chrom-bar">
                    <div class="locus fixed-allele">A</div>
                    <div class="locus drop-zone pos-bottom" data-valid="false" data-error="same"></div>
                </div>
                <div class="chrom-bar" style="background:#90caf9; border-color:#1976d2;">
                    <div class="locus drop-zone pos-top" data-valid="true"></div>
                    <div class="locus drop-zone pos-bottom" data-valid="false" data-error="pos"></div>
                </div>
            </div>
            <div class="allele-source">
                <div class="draggable-allele" draggable="true">A</div>
                <div class="draggable-allele" draggable="true">a</div>
                <div class="draggable-allele" draggable="true">B</div>
                <div class="draggable-allele" draggable="true">b</div>
            </div>
            <div id="game-feedback" style="margin-top:15px; font-weight:bold; min-height:30px;"></div>
        </div>
    </section>

    <!-- Part 4: Myth -->
    <section id="s4" class="locked">
        <h2><i class="fas fa-user-md"></i> 4. è¿·æ€è¨ºæ–·å®¤</h2>
        <div class="myth-grid">
            <div class="myth-card" id="myth-1">
                <p class="myth-statement">1. ç­‰ä½åŸºå› æ˜¯ã€Œä¸åŒçš„åŸºå› ã€ï¼ˆä¾‹å¦‚æ§åˆ¶çœ¼è‰²å’Œèº«é«˜çš„åŸºå› ï¼‰ï¼Ÿ</p>
                <div style="margin-top:auto;"><button class="myth-btn" onclick="answerMyth(1, false)">â­• æ˜¯</button><button class="myth-btn" onclick="answerMyth(1, true)">âŒ å¦</button></div><div class="myth-fb" id="mfb-1"></div>
            </div>
            <div class="myth-card" id="myth-2">
                <p class="myth-statement">2. ç­‰ä½åŸºå› æ˜¯ä½æ–¼ã€ŒåŒä¸€æ¢æŸ“è‰²é«”ã€ä¸Šçš„å…©å€‹åŸºå› ï¼Ÿ</p>
                <div style="margin-top:auto;"><button class="myth-btn" onclick="answerMyth(2, false)">â­• æ˜¯</button><button class="myth-btn" onclick="answerMyth(2, true)">âŒ å¦</button></div><div class="myth-fb" id="mfb-2"></div>
            </div>
            <div class="myth-card" id="myth-3">
                <p class="myth-statement">3. ç­‰ä½åŸºå› ä¸€å®šä½æ–¼ã€ŒåŒæºæŸ“è‰²é«”çš„ç›¸å°ä½ç½®ã€ï¼Ÿ</p>
                <div style="margin-top:auto;"><button class="myth-btn" onclick="answerMyth(3, true)">â­• æ˜¯</button><button class="myth-btn" onclick="answerMyth(3, false)">âŒ å¦</button></div><div class="myth-fb" id="mfb-3"></div>
            </div>
            <div class="myth-card" id="myth-4">
                <p class="myth-statement">4. é‡å°åŒä¸€æ€§ç‹€ï¼Œä¸€å€‹å€‹é«”æœ€å¤šæœ‰å…©å€‹ç­‰ä½åŸºå› ï¼Ÿ</p>
                <div style="margin-top:auto;"><button class="myth-btn" onclick="answerMyth(4, true)">â­• æ˜¯</button><button class="myth-btn" onclick="answerMyth(4, false)">âŒ å¦</button></div><div class="myth-fb" id="mfb-4"></div>
            </div>
        </div>
        <div class="mendel-link" id="final-link" style="display:none; text-align:center; margin-top:30px; animation: pop 0.5s;">
            <div style="background:#fff8e1; padding:20px; border-radius:10px; border:2px dashed #ffa000;">
                <i class="fas fa-link"></i> <b>è§€å¿µé€£çµï¼š</b>æˆ‘å€‘ç¾åœ¨å­¸çš„ã€Œç­‰ä½åŸºå› ã€ï¼Œå°±æ˜¯å­Ÿå¾·çˆ¾ç•¶å¹´æå‡ºçš„ã€Œéºå‚³å› å­ã€å–”ï¼
            </div>
        </div>
    </section>

    <!-- Nav -->
    <div class="footer-nav">
        <a href="mi06w.html" class="next-btn" id="next-btn">å‰å¾€ä¸‹ä¸€é—œï¼šå­¸ç¿’ç¸½çµ <i class="fas fa-arrow-right"></i></a>
    </div>

</div>

<script>
    // --- Part 1: Zoom ---
    function submitAnswer(level) {
        const input = document.getElementById(`ans-${level}`);
        const ans = input.value.trim();
        let correct = false;
        if (level === 1 && ans.includes('ç´°èƒæ ¸')) correct = true;
        if (level === 2 && ans.includes('æŸ“è‰²é«”')) correct = true;
        if (level === 3 && ans.includes('åŸºå› ')) correct = true;

        if (correct) {
            input.classList.add('correct');
            const currentObj = (level === 1) ? document.getElementById('view-cell') : (level === 2) ? document.getElementById('view-chromo') : document.getElementById('view-dna');
            if (currentObj) currentObj.classList.add('zoom-out-vanish');
            
            setTimeout(() => {
                if (currentObj) {
                    currentObj.style.display = 'none';
                    currentObj.classList.remove('zoom-out-vanish');
                }
                
                if (level === 1) { 
                    document.getElementById('view-chromo').style.display = 'flex'; 
                    document.getElementById('q1-box').style.display = 'none'; 
                    document.getElementById('q2-box').style.display = 'block'; 
                } else if (level === 2) { 
                    document.getElementById('view-dna').style.display = 'flex'; 
                    document.getElementById('q2-box').style.display = 'none'; 
                    document.getElementById('q3-box').style.display = 'block'; 
                } else if (level === 3) { 
                    // Safely handle elements that might not exist if HTML structure changed
                    const geneHl = document.querySelector('.gene-box-highlight');
                    if(geneHl) geneHl.style.display = 'none';
                    
                    const viewFinal = document.getElementById('view-final');
                    if(viewFinal) viewFinal.style.display = 'flex';
                    else {
                        const viewDna = document.getElementById('view-dna');
                        if(viewDna) viewDna.style.display = 'flex';
                    }
                    
                    document.getElementById('q3-box').style.display = 'none'; 
                    initSortGame();
                    const sortGame = document.getElementById('sort-game');
                    if(sortGame) sortGame.style.display = 'block';
                }
            }, 800);
        } else {
            const qBox = document.getElementById(`q${level}-box`); 
            if(qBox) {
                qBox.style.animation = 'shake 0.5s'; 
                setTimeout(() => qBox.style.animation = '', 500);
            }
            let hint = ''; if(level===1) hint = 'æç¤ºï¼šæŸ“è‰²é«”ä½æ–¼ç´°èƒçš„ä¸­å¿ƒæ§‹é€ ...'; if(level===2) hint = 'æç¤ºï¼šDNA èˆ‡è›‹ç™½è³ªçºç¹æœƒè®Šæˆ...'; if(level===3) hint = 'æç¤ºï¼šå…·æœ‰åŠŸèƒ½çš„ç‰‡æ®µå«åš...';
            alert('ç­”éŒ¯å›‰ï¼' + hint); input.focus();
        }
    }

    // --- Sort Game Logic ---
    const sortItems = ["ç´°èƒæ ¸", "æŸ“è‰²é«”", "ä¸€æ¢DNA", "åŸºå› ", "ä¸€å€‹DNAåˆ†å­"];
    let sortDragItem = null;

    function initSortGame() {
        const source = document.getElementById('sort-source');
        if(!source) return;
        
        let cards = [...sortItems].sort(() => Math.random() - 0.5);
        cards.forEach(item => {
            let el = document.createElement('div');
            el.className = 'sort-card';
            el.draggable = true;
            el.innerText = item;
            el.addEventListener('dragstart', e => { sortDragItem = e.target; });
            el.addEventListener('touchstart', e => { e.preventDefault(); sortDragItem = e.target; sortDragItem.style.position='absolute'; }); 
            el.addEventListener('touchend', e => { 
                if(!sortDragItem) return;
                sortDragItem.style.position = '';
                const touch = e.changedTouches[0];
                const elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                const slot = elemBelow ? elemBelow.closest('.sort-slot') : null;
                if(slot) {
                     if(slot.children.length > 0) source.appendChild(slot.children[0]);
                     slot.appendChild(sortDragItem);
                } else document.getElementById('sort-source').appendChild(sortDragItem);
                sortDragItem = null;
            });
            source.appendChild(el);
        });
        
        document.querySelectorAll('.sort-slot').forEach(slot => {
            slot.addEventListener('dragover', e => e.preventDefault());
            slot.addEventListener('drop', e => {
                e.preventDefault();
                if(sortDragItem) {
                    if(slot.children.length > 0) source.appendChild(slot.children[0]);
                    slot.appendChild(sortDragItem);
                }
            });
        });
    }

    function checkSortGame() {
        const slots = document.querySelectorAll('.sort-slot');
        let correctCount = 0;
        
        slots.forEach((slot, index) => {
            if(slot.children.length > 0) {
                const val = slot.children[0].innerText;
                if(val === sortItems[index]) correctCount++;
            }
        });

        const feedback = document.getElementById('sort-feedback');
        
        if (correctCount === 5) {
            feedback.style.color = "green";
            feedback.innerHTML = "ç­”å°äº†ï¼é †åºæ˜¯ï¼šç´°èƒæ ¸ > æŸ“è‰²é«” > ä¸€æ¢DNA > åŸºå›  > ä¸€å€‹DNAåˆ†å­";
            
            const viewDna = document.getElementById('view-dna');
            if(viewDna) viewDna.style.display = 'none';
            
            const level4 = document.getElementById('level-4');
            if(level4) level4.style.display = 'flex';
            
            setTimeout(() => { const s2 = document.getElementById('s2'); s2.classList.remove('locked'); s2.scrollIntoView({behavior: "smooth", block: "center"}); }, 2000);
        } else {
            feedback.style.color = "red";
            feedback.innerText = "é †åºä¸å°å–”ï¼å¡ç‰‡å°‡åœ¨ 1 ç§’å¾Œæ­¸ä½ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
            setTimeout(() => {
                const source = document.getElementById('sort-source');
                const cards = document.querySelectorAll('.sort-card');
                cards.forEach(card => source.appendChild(card));
                for (let i = source.children.length; i >= 0; i--) {
                    source.appendChild(source.children[Math.random() * i | 0]);
                }
                feedback.innerText = "";
            }, 1000);
        }
    }

    // --- Part 2: Diagram (Dedicated Logic) ---
    const p2Answers = { 'A': 'homo', 'B': 'dna', 'C': 'gene', 'D': 'allele' };
    function verifyConcept(step) {
        const selectEl = document.getElementById(`p2-select-${step}`);
        const val = selectEl.value;
        if (val === p2Answers[step]) {
            selectEl.classList.add('correct'); selectEl.disabled = true;
            document.getElementById(`overlay-${step}`).classList.remove('active');
            
            let nextStep = '';
            if (step === 'A') nextStep = 'B'; else if (step === 'B') nextStep = 'C'; else if (step === 'C') nextStep = 'D';
            
            document.getElementById(`p2-step-${step}`).style.display = 'none';
            if (nextStep) {
                document.getElementById(`p2-step-${nextStep}`).classList.add('active');
                document.getElementById(`overlay-${nextStep}`).classList.add('active');
            } else {
                document.getElementById('s2-feedback').innerText = "å¤ªæ£’äº†ï¼è§€å¿µå…¨éƒ¨æ­£ç¢ºï¼";
                setTimeout(() => { const s25 = document.getElementById('s2-5'); s25.classList.remove('locked'); s25.scrollIntoView({behavior: "smooth", block: "center"}); }, 1000);
            }
        } else {
            selectEl.classList.add('wrong'); setTimeout(() => selectEl.classList.remove('wrong'), 500);
        }
    }

    // --- Part 2.5: Locus Quiz (Multiple Questions) ---
    function checkLocusQuiz(qNum, val) {
        const fb = document.getElementById('locus-feedback');
        let correct = false;
        
        if (qNum === 1 && val === 3) correct = true; // 2å€‹, 2ç¨®
        else if (qNum === 2 && val === 2) correct = true; // 3ç¨®
        else if (qNum === 3 && val === 1) correct = true; // ä½ç½®

        if (correct) {
            fb.style.color = "green"; fb.innerText = "ç­”å°äº†ï¼";
            // Next Question Logic
            setTimeout(() => {
                document.getElementById(`locus-q${qNum}`).style.display = 'none';
                fb.innerText = "";
                if (qNum < 3) {
                    document.getElementById(`locus-q${qNum+1}`).style.display = 'block';
                } else {
                    fb.innerText = "æ­å–œé€šé—œï¼æº–å‚™é€²å…¥å®šä½è³½ï¼";
                    setTimeout(() => { const s3 = document.getElementById('s3'); s3.classList.remove('locked'); s3.scrollIntoView({behavior: "smooth", block: "center"}); }, 1000);
                }
            }, 1000);
        } else {
            fb.style.color = "red"; fb.innerText = "ä¸å°å–”ï¼Œå†æƒ³ä¸€ä¸‹ã€‚";
        }
    }

    // --- Part 3: Drag ---
    const draggables = document.querySelectorAll('.draggable-allele'); const zones = document.querySelectorAll('.drop-zone'); let activeDrag = null;
    draggables.forEach(d => {
        d.addEventListener('dragstart', (e) => { e.dataTransfer.setData('text', e.target.innerText); activeDrag = e.target; });
        d.addEventListener('touchstart', (e) => { e.preventDefault(); activeDrag = e.target; activeDrag.style.position = 'absolute'; activeDrag.style.zIndex = 1000; });
        d.addEventListener('touchmove', (e) => { e.preventDefault(); const t = e.touches[0]; activeDrag.style.left = t.clientX - 30 + 'px'; activeDrag.style.top = t.clientY - 30 + 'px'; });
        d.addEventListener('touchend', (e) => {
            if (!activeDrag) return; const t = e.changedTouches[0]; activeDrag.style.display = 'none'; const el = document.elementFromPoint(t.clientX, t.clientY); activeDrag.style.display = 'flex';
            const zone = el ? el.closest('.drop-zone') : null; if (zone) handleDrop(zone, activeDrag.innerText); else { activeDrag.style.position = 'static'; } activeDrag = null;
        });
        d.addEventListener('dragend', () => { activeDrag = null; });
    });
    zones.forEach(z => {
        z.addEventListener('dragover', (e) => { e.preventDefault(); z.classList.add('hover'); }); z.addEventListener('dragleave', () => z.classList.remove('hover'));
        z.addEventListener('drop', (e) => { e.preventDefault(); z.classList.remove('hover'); const val = e.dataTransfer.getData('text'); handleDrop(z, val); });
    });
    function handleDrop(zone, val) {
        const feedback = document.getElementById('game-feedback'); const isValid = zone.dataset.valid === "true"; const errorType = zone.dataset.error;
        if (activeDrag && activeDrag.style.position === 'absolute') { activeDrag.style.position = 'static'; }
        if (val !== 'A') { feedback.innerHTML = "<span style='color:red'>åŸºå› å‹æ˜¯ AA å–”ï¼ä½ æ‹¿éŒ¯äº†ã€‚</span>"; return; }
        if (isValid) {
            zone.innerText = val; zone.style.background = "white"; zone.style.border = "3px solid #4CAF50"; feedback.innerHTML = "<span style='color:green'>ç­”å°äº†ï¼</span>";
            setTimeout(() => { const s4 = document.getElementById('s4'); s4.classList.remove('locked'); s4.scrollIntoView({behavior: "smooth", block: "center"}); }, 1000);
        } else {
            if (errorType === 'same') feedback.innerHTML = "<span style='color:red'>éŒ¯èª¤ï¼ç­‰ä½åŸºå› ä¸æœƒåœ¨ã€ŒåŒä¸€æ¢ã€æŸ“è‰²é«”ä¸Šã€‚</span>";
            else if (errorType === 'pos') feedback.innerHTML = "<span style='color:red'>ä½ç½®ä¸å°ï¼å¿…é ˆåœ¨ã€Œç›¸å°ã€ä½ç½®ã€‚</span>";
        }
    }

    // --- Part 4: Myth ---
    let myths = [false, false, false, false];
    function answerMyth(idx, isCorrect) {
        const fb = document.getElementById(`mfb-${idx}`); const card = document.getElementById(`myth-${idx}`);
        if (isCorrect) {
            fb.style.color = "green"; fb.innerText = "è§€å¿µæ­£ç¢ºï¼"; myths[idx-1] = true; card.style.borderColor = "green"; card.style.background = "#e8f5e9";
        } else { fb.style.color = "red"; fb.innerText = "ç­”éŒ¯å›‰ã€‚"; }
        if (myths.every(Boolean)) { document.getElementById('final-link').style.display = 'block'; document.getElementById('next-btn').classList.add('active'); }
    }
</script>
</body>
</html>